const { fetch } = require("undici");
const fs = require("fs");
const path = require("path");

class staticBRHoliday {
  async getHolidays(year) {
    const holidays = await fetch(
      `https://brasilapi.com.br/api/feriados/v1/${year}`
    );
    const data = await holidays.json();
    return data;
  }
}

async function generateStaticData() {
  const brHoliday = new staticBRHoliday();
  const currentYear = new Date().getFullYear();
  const years = [
    currentYear - 2,
    currentYear - 1,
    currentYear,
    currentYear + 1,
    currentYear + 2,
  ];

  const holidaysMap = {};

  for (const year of years) {
    const holidays = await brHoliday.getHolidays(year);
    holidaysMap[year] = holidays;
  }

  return `// Static data generated by @aquarela/br-holiday
export const staticHolidays = ${JSON.stringify(holidaysMap, null, 2)};`;
}

generateStaticData().then((content) => {
  const dataDir = path.join(__dirname, "../dist/data");
  if (!fs.existsSync(dataDir)) {
    fs.mkdirSync(dataDir, { recursive: true });
  }

  fs.writeFileSync(path.join(dataDir, "index.js"), content);
});
